#!/usr/bin/env node --experimental-wasi-unstable-preview1
// require('../dist/CLI.js')

const fs = require("fs");
const { WASI } = require("wasi");
const path = require('path')

const [_node, _bin, ...rest] = process.argv

const wasi = new WASI({
  args: rest,
  preopens: {
    [rest[0]]: path.resolve(rest[0])
  }
});

const importObject = { wasi_snapshot_preview1: wasi.wasiImport };

(async () => {
  const wasm = await WebAssembly.compile(
    fs.readFileSync("../codegen-rust/target/wasm32-wasi/release/codegen-rust.wasi.wasm")
  );
  const instance = await WebAssembly.instantiate(wasm, importObject);

  wasi.start(instance);
})();